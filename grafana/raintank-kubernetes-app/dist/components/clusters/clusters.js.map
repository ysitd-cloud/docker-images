{"version":3,"sources":["../../../src/components/clusters/clusters.js"],"names":["_","appEvents","ClustersCtrl","$scope","$injector","backendSrv","contextSrv","$location","self","isOrgEditor","hasRole","document","title","clusters","pageReady","getClusters","then","get","result","filter","id","delete","cluster","emit","text","yesText","icon","onConfirm","confirmDelete","path","search","templateUrl"],"mappings":";;;;;;;;;;;;;;;AAAOA,O;;AACAC,e;;;;;;;;;;;;;;;;;;;;;8BAEMC,Y;AACX;AACA,8BAAYC,MAAZ,EAAoBC,SAApB,EAA+BC,UAA/B,EAA2CC,UAA3C,EAAuDC,SAAvD,EAAkE;AAAA;;AAChE,cAAIC,OAAO,IAAX;AACA,eAAKC,WAAL,GAAmBH,WAAWI,OAAX,CAAmB,QAAnB,KAAgCJ,WAAWI,OAAX,CAAmB,OAAnB,CAAnD;AACA,eAAKL,UAAL,GAAkBA,UAAlB;AACA,eAAKE,SAAL,GAAiBA,SAAjB;AACAI,mBAASC,KAAT,GAAiB,wBAAjB;AACA,eAAKC,QAAL,GAAgB,EAAhB;AACA,eAAKC,SAAL,GAAiB,KAAjB;AACA,eAAKC,WAAL,GAAmBC,IAAnB,CAAwB,YAAM;AAC5BR,iBAAKM,SAAL,GAAiB,IAAjB;AACD,WAFD;AAGD;;;;wCAEa;AACZ,gBAAIN,OAAO,IAAX;AACA,mBAAO,KAAKH,UAAL,CAAgBY,GAAhB,CAAoB,kBAApB,EACND,IADM,CACD,UAACE,MAAD,EAAY;AAChBV,mBAAKK,QAAL,GAAgBb,EAAEmB,MAAF,CAASD,MAAT,EAAiB,EAAC,QAAQ,gCAAT,EAAjB,CAAhB;AACD,aAHM,CAAP;AAID;;;wCAEaE,E,EAAI;AAAA;;AAChB,iBAAKf,UAAL,CAAgBgB,MAAhB,CAAuB,sBAAsBD,EAA7C,EAAiDJ,IAAjD,CAAsD,YAAM;AAC1D,oBAAKD,WAAL;AACD,aAFD;AAGD;;;wCAEaO,O,EAAS;AAAA;;AACrBrB,sBAAUsB,IAAV,CAAe,eAAf,EAAgC;AAC9BX,qBAAO,QADuB;AAE9BY,oBAAM,uDACJ,uFAH4B;AAI9BC,uBAAS,QAJqB;AAK9BC,oBAAM,UALwB;AAM9BC,yBAAW,qBAAM;AACf,uBAAKC,aAAL,CAAmBN,QAAQF,EAA3B;AACD;AAR6B,aAAhC;AAUD;;;sCAEWE,O,EAAS;AACnB,iBAAKf,SAAL,CAAesB,IAAf,CAAoB,mDAApB,EAAyEC,MAAzE,CAAgF,EAAC,WAAWR,QAAQF,EAApB,EAAhF;AACD;;;;;;;;AAGHlB,mBAAa6B,WAAb,GAA2B,4CAA3B","file":"clusters.js","sourcesContent":["import _ from 'lodash';\nimport appEvents from 'app/core/app_events';\n\nexport class ClustersCtrl {\n  /** @ngInject */\n  constructor($scope, $injector, backendSrv, contextSrv, $location) {\n    var self = this;\n    this.isOrgEditor = contextSrv.hasRole('Editor') || contextSrv.hasRole('Admin');\n    this.backendSrv = backendSrv;\n    this.$location = $location;\n    document.title = 'Grafana Kubernetes App';\n    this.clusters = {};\n    this.pageReady = false;\n    this.getClusters().then(() => {\n      self.pageReady = true;\n    });\n  }\n\n  getClusters() {\n    var self = this;\n    return this.backendSrv.get('/api/datasources')\n    .then((result) => {\n      self.clusters = _.filter(result, {\"type\": \"raintank-kubernetes-datasource\"});\n    });\n  }\n\n  confirmDelete(id) {\n    this.backendSrv.delete('/api/datasources/' + id).then(() => {\n      this.getClusters();\n    });\n  }\n\n  deleteCluster(cluster) {\n    appEvents.emit('confirm-modal', {\n      title: 'Delete',\n      text: 'Are you sure you want to delete this data source? ' +\n        'If you need to undeploy the collectors, then do that before deleting the data source.',\n      yesText: \"Delete\",\n      icon: \"fa-trash\",\n      onConfirm: () => {\n        this.confirmDelete(cluster.id);\n      }\n    });\n  }\n\n  clusterInfo(cluster) {\n    this.$location.path(\"plugins/raintank-kubernetes-app/page/cluster-info\").search({\"cluster\": cluster.id});\n  }\n}\n\nClustersCtrl.templateUrl = 'components/clusters/partials/clusters.html';\n"]}